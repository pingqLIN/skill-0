{
  "meta": {
    "skill_id": "mcp__database__query_analyzer",
    "name": "Database Query Analyzer",
    "skill_layer": "mcp_tool",
    "server": "database-mcp",
    "title": "Analyze and execute database queries",
    "description": "MCP tool that connects to databases, analyzes query performance, and provides optimization suggestions",
    "schema_version": "2.2.0",
    "parse_timestamp": "2026-01-30T14:00:00Z",
    "parser_version": "2.2.0",
    "parsed_by": "skill-0",
    "resources": [
      {
        "type": "database",
        "name": "primary_database",
        "required": true,
        "description": "Primary database connection for query execution",
        "specification": {
          "provider": "PostgreSQL",
          "version": ">=14.0",
          "endpoint": "postgresql://localhost:5432/mydb",
          "permissions": [
            "SELECT",
            "EXPLAIN"
          ]
        },
        "fallback": "Use read-only replica if primary is unavailable"
      },
      {
        "type": "credentials",
        "name": "db_credentials",
        "required": true,
        "description": "Database authentication credentials",
        "specification": {
          "provider": "environment",
          "permissions": [
            "read"
          ]
        }
      },
      {
        "type": "memory",
        "name": "query_cache",
        "required": false,
        "description": "In-memory cache for frequently used queries",
        "specification": {
          "provider": "Redis",
          "version": ">=7.0"
        },
        "fallback": "Skip caching if memory resource unavailable"
      }
    ]
  },
  "decomposition": {
    "actions": [
      {
        "id": "a_001",
        "name": "Connect to Database",
        "action_type": "external_call",
        "description": "Establish connection to the database server",
        "deterministic": false,
        "immutable_elements": [
          "connection_protocol: PostgreSQL",
          "connection_method: TCP/IP"
        ],
        "mutable_elements": [
          "host",
          "port",
          "database_name",
          "credentials"
        ],
        "side_effects": [
          "network_connection",
          "session_creation"
        ],
        "resources": [
          {
            "type": "database",
            "name": "primary_database",
            "required": true,
            "description": "Database server connection"
          },
          {
            "type": "network",
            "name": "tcp_connection",
            "required": true,
            "description": "Network connectivity to database server"
          },
          {
            "type": "credentials",
            "name": "db_credentials",
            "required": true,
            "description": "Authentication credentials"
          }
        ]
      },
      {
        "id": "a_002",
        "name": "Parse SQL Query",
        "action_type": "transform",
        "description": "Parse and validate SQL query syntax",
        "deterministic": true,
        "immutable_elements": [
          "parser: SQL standard compliant"
        ],
        "mutable_elements": [
          "query_string"
        ],
        "side_effects": []
      },
      {
        "id": "a_003",
        "name": "Execute EXPLAIN",
        "action_type": "external_call",
        "description": "Execute EXPLAIN command to get query execution plan",
        "deterministic": false,
        "immutable_elements": [
          "command: EXPLAIN"
        ],
        "mutable_elements": [
          "query"
        ],
        "side_effects": [
          "database_query"
        ],
        "resources": [
          {
            "type": "database",
            "name": "primary_database",
            "required": true,
            "description": "Database connection for EXPLAIN execution"
          }
        ]
      },
      {
        "id": "a_004",
        "name": "Analyze Query Plan",
        "action_type": "llm_inference",
        "description": "Use LLM to analyze query execution plan and identify bottlenecks",
        "deterministic": false,
        "immutable_elements": [],
        "mutable_elements": [
          "execution_plan",
          "table_statistics"
        ],
        "side_effects": [],
        "resources": [
          {
            "type": "api",
            "name": "llm_api",
            "required": true,
            "description": "LLM API for query analysis",
            "specification": {
              "provider": "OpenAI",
              "endpoint": "https://api.openai.com/v1"
            }
          },
          {
            "type": "credentials",
            "name": "openai_api_key",
            "required": true,
            "description": "OpenAI API authentication key"
          }
        ]
      },
      {
        "id": "a_005",
        "name": "Generate Optimization Suggestions",
        "action_type": "transform",
        "description": "Transform analysis results into actionable optimization suggestions",
        "deterministic": true,
        "immutable_elements": [],
        "mutable_elements": [
          "analysis_results"
        ],
        "side_effects": []
      },
      {
        "id": "a_006",
        "name": "Cache Results",
        "action_type": "io_write",
        "description": "Cache query analysis results for future reference",
        "deterministic": true,
        "immutable_elements": [],
        "mutable_elements": [
          "cache_key",
          "results"
        ],
        "side_effects": [
          "memory_write"
        ],
        "resources": [
          {
            "type": "memory",
            "name": "query_cache",
            "required": false,
            "description": "Redis cache for storing results",
            "fallback": "Skip caching if unavailable"
          }
        ]
      }
    ],
    "rules": [
      {
        "id": "r_001",
        "name": "Check Database Connection",
        "condition_type": "state_check",
        "condition_expression": "database_connection.is_alive() == true",
        "returns": "boolean",
        "fail_action": "halt"
      },
      {
        "id": "r_002",
        "name": "Validate SQL Syntax",
        "condition_type": "validation",
        "condition_expression": "sql_parser.is_valid(query) == true",
        "returns": "boolean",
        "fail_action": "error_throw"
      },
      {
        "id": "r_003",
        "name": "Check Query Complexity",
        "condition_type": "threshold_check",
        "condition_expression": "query_complexity < MAX_COMPLEXITY_THRESHOLD",
        "returns": "boolean",
        "fail_action": "branch",
        "branching_targets": [
          "path_2"
        ]
      }
    ],
    "directives": [
      {
        "id": "d_001",
        "name": "Query Analysis Complete",
        "directive_type": "completion",
        "description": "Query has been analyzed and optimization suggestions generated",
        "decomposable": false
      },
      {
        "id": "d_002",
        "name": "Database Best Practices",
        "directive_type": "knowledge",
        "description": "Follow PostgreSQL performance tuning best practices including proper indexing, query planning, and connection pooling",
        "decomposable": true,
        "decomposition_hint": "Can be expanded into specific indexing strategies, query optimization techniques, and connection management rules"
      },
      {
        "id": "d_003",
        "name": "Minimize Database Load",
        "directive_type": "principle",
        "description": "Always minimize database load by using efficient queries, proper caching, and avoiding N+1 problems",
        "decomposable": true
      },
      {
        "id": "d_004",
        "name": "Resource Cleanup",
        "directive_type": "strategy",
        "description": "Always clean up database connections and cache entries after use to prevent resource leaks",
        "decomposable": true
      }
    ]
  },
  "execution_paths": [
    {
      "path_id": 1,
      "sequence": [
        "a_001",
        "r_001",
        "a_002",
        "r_002",
        "a_003",
        "a_004",
        "r_003",
        "a_005",
        "a_006",
        "d_001"
      ],
      "condition": "Database connection successful AND query syntax valid AND complexity acceptable",
      "expected_outcome": "Query analyzed with optimization suggestions",
      "probability": "80%"
    },
    {
      "path_id": 2,
      "sequence": [
        "a_001",
        "r_001",
        "a_002",
        "r_002",
        "r_003",
        "d_001"
      ],
      "condition": "Query complexity exceeds threshold",
      "expected_outcome": "Query rejected with complexity warning",
      "probability": "15%",
      "_note": "High complexity queries require manual review"
    }
  ],
  "parser_meta": {
    "paths_enumerated": 2,
    "max_paths_exceeded": false,
    "max_paths_limit": 100,
    "halt_reason": null,
    "decomposition_depth": 1,
    "directives_expandable": 3,
    "requires_deep_parse": false
  }
}
